/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'application'
}

applicationDefaultJvmArgs = ["-Xms512m", "-Xmx1024m"]

repositories {
    jcenter()
}

// Set default broker if not specified from command line
def whichBroker = project.properties['broker']?:'ActiveMQ'

dependencies {
    compile 'ch.qos.logback:logback-classic:1.2.0'
    compile 'javax.jms:javax.jms-api:2.0'
    
    switch (whichBroker) {
        case "ActiveMQ":
            runtimeOnly 'org.apache.activemq:activemq-client:5.15.12'
            runtimeOnly 'org.apache.geronimo.specs:geronimo-j2ee-management_1.1_spec:1.0.1'
            break;

        case "Artemis":
            runtimeOnly 'org.apache.activemq:artemis-jms-client-all:2.11.0'
            break;

        case "TIBCO":
            runtimeOnly files('local_libs/tibjms.jar') 
            break;

        case "Broker-J":
            runtimeOnly 'org.apache.qpid:qpid-jms-client:0.50.0'
            break;
        
        default:
            println "No broker defines"
    }
}

group = 'jmsex_demo_services'
version = '2.0.0'
sourceCompatibility = '1.8'

mainClassName = "jms_demo_services.JmsStockListDemoService"

task feedMessageJar(type:Jar, dependsOn: classes) {
    baseName = commonJarName
    from sourceSets.main.output.classesDirs.filter {
        include '**/FeedMessage.class'
    }
}

task brokerLibs(type: Copy, dependsOn: [feedMessageJar, installDist]) {
    description 'Copies the jar files to the lib/log folder of the source docker image directory.'
    from ("$buildDir/install/$project.name/lib") {
        exclude "javax.jms-api-*.jar"
        exclude "logback-*.jar"
        exclude "slf4j-*.jar"
        exclude "$applicationName-*.jar"
    }
    from ("$libsDir") {
        include "$commonJarName-*.jar"
    }
    
    into "$buildDir/brokersLib"
}

